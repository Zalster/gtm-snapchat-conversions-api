___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Snapchat Conversions API",
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,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\u003d"
  },
  "description": "A server-side tag template to parse and send GA4 client requests to Snapchat through their Conversions API.",
  "containerContexts": [
    "SERVER"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "GROUP",
    "name": "pixelSettings",
    "displayName": "Pixel Settings",
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "type": "TEXT",
        "name": "pixelId",
        "displayName": "Snap Pixel ID",
        "simpleValueType": true,
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ]
      },
      {
        "type": "TEXT",
        "name": "apiToken",
        "displayName": "Conversions API Token",
        "simpleValueType": true,
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ]
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "eventSettings",
    "displayName": "Event Settings",
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "type": "RADIO",
        "name": "eventNameRadio",
        "displayName": "",
        "radioItems": [
          {
            "value": "client",
            "displayValue": "Inherit from GA4 Client (default)",
            "help": "Use this setting if you are using the standard events in the GA4 Client. This setting will try to map and convert any GA4 Event into a Snapchat Standard Event. Recommended for Ecommerce sites. This works only for Web Events."
          },
          {
            "value": "custom",
            "displayValue": "Custom Setup",
            "subParams": [
              {
                "type": "RADIO",
                "name": "standardEventNameRadio",
                "displayName": "",
                "radioItems": [
                  {
                    "value": "standard",
                    "displayValue": "Standard Event Name",
                    "subParams": [
                      {
                        "type": "SELECT",
                        "name": "standardEventName",
                        "macrosInSelect": false,
                        "selectItems": [
                          {
                            "value": "ACHIEVEMENT_UNLOCKED",
                            "displayValue": "ACHIEVEMENT_UNLOCKED"
                          },
                          {
                            "value": "ADD_BILLING",
                            "displayValue": "ADD_BILLING"
                          },
                          {
                            "value": "ADD_CART",
                            "displayValue": "ADD_CART"
                          },
                          {
                            "value": "ADD_TO_WISHLIST",
                            "displayValue": "ADD_TO_WISHLIST"
                          },
                          {
                            "value": "AD_CLICK",
                            "displayValue": "AD_CLICK"
                          },
                          {
                            "value": "AD_VIEW",
                            "displayValue": "AD_VIEW"
                          },
                          {
                            "value": "APP_INSTALL",
                            "displayValue": "APP_INSTALL"
                          },
                          {
                            "value": "APP_OPEN",
                            "displayValue": "APP_OPEN"
                          },
                          {
                            "value": "COMPLETE_TUTORIAL",
                            "displayValue": "COMPLETE_TUTORIAL"
                          },
                          {
                            "value": "INVITE",
                            "displayValue": "INVITE"
                          },
                          {
                            "value": "LIST_VIEW",
                            "displayValue": "LIST_VIEW"
                          },
                          {
                            "value": "LOGIN",
                            "displayValue": "LOGIN"
                          },
                          {
                            "value": "PAGE_VIEW",
                            "displayValue": "PAGE_VIEW"
                          },
                          {
                            "value": "RATE",
                            "displayValue": "RATE"
                          },
                          {
                            "value": "RESERVE",
                            "displayValue": "RESERVE"
                          },
                          {
                            "value": "SAVE",
                            "displayValue": "SAVE"
                          },
                          {
                            "value": "SEARCH",
                            "displayValue": "SEARCH"
                          },
                          {
                            "value": "SHARE",
                            "displayValue": "SHARE"
                          },
                          {
                            "value": "SIGN_UP",
                            "displayValue": "SIGN_UP"
                          },
                          {
                            "value": "SPENT_CREDITS",
                            "displayValue": "SPENT_CREDITS"
                          },
                          {
                            "value": "START_CHECKOUT",
                            "displayValue": "START_CHECKOUT"
                          },
                          {
                            "value": "START_TRIAL",
                            "displayValue": "START_TRIAL"
                          },
                          {
                            "value": "SUBSCRIBE",
                            "displayValue": "SUBSCRIBE"
                          },
                          {
                            "value": "VIEW_CONTENT",
                            "displayValue": "VIEW_CONTENT"
                          },
                          {
                            "value": "PURCHASE",
                            "displayValue": "PURCHASE"
                          }
                        ],
                        "simpleValueType": true,
                        "enablingConditions": [
                          {
                            "paramName": "standardEventNameRadio",
                            "paramValue": "standard",
                            "type": "EQUALS"
                          }
                        ]
                      }
                    ]
                  },
                  {
                    "value": "custom",
                    "displayValue": "Custom Event Name",
                    "subParams": [
                      {
                        "type": "TEXT",
                        "name": "customEventName",
                        "simpleValueType": true,
                        "enablingConditions": [
                          {
                            "paramName": "standardEventNameRadio",
                            "paramValue": "custom",
                            "type": "EQUALS"
                          }
                        ]
                      }
                    ]
                  }
                ],
                "simpleValueType": true
              },
              {
                "type": "SELECT",
                "name": "eventConversionType",
                "displayName": "Event Conversion Type",
                "macrosInSelect": false,
                "selectItems": [
                  {
                    "value": "WEB",
                    "displayValue": "WEB"
                  },
                  {
                    "value": "OFFLINE",
                    "displayValue": "OFFLINE"
                  },
                  {
                    "value": "MOBILE_APP",
                    "displayValue": "MOBILE_APP"
                  }
                ],
                "simpleValueType": true,
                "enablingConditions": [
                  {
                    "paramName": "eventNameRadio",
                    "paramValue": "custom",
                    "type": "EQUALS"
                  }
                ]
              },
              {
                "type": "TEXT",
                "name": "eventTag",
                "displayName": "Event Tag",
                "simpleValueType": true,
                "enablingConditions": [
                  {
                    "paramName": "eventNameRadio",
                    "paramValue": "custom",
                    "type": "EQUALS"
                  }
                ]
              }
            ]
          }
        ],
        "simpleValueType": true,
        "defaultValue": "client"
      }
    ]
  }
]


___SANDBOXED_JS_FOR_SERVER___

// GTM JS Libraries
const getAllEventData = require('getAllEventData');
const getContainerVersion = require('getContainerVersion');
const getCookieValues = require('getCookieValues');
const getRemoteAddress = require('getRemoteAddress');
const getTimestampMillis = require('getTimestampMillis');
const getType= require('getType');
const JSON = require('JSON');
const logToConsole = require('logToConsole');
const Math = require('Math');
const makeString = require('makeString');
const makeInteger = require('makeInteger');
const makeNumber = require('makeNumber');
const sendHttpRequest = require('sendHttpRequest');
const setCookie = require('setCookie');
const sha256Sync = require('sha256Sync');

// Constants
const containerVersion = getContainerVersion();
const isDebug = containerVersion.debugMode;

// GA4 Events map
const ga4Events = {
  "page_view": "PAGE_VIEW",
  "view_item": "VIEW_CONTENT",
  "view_item_ist": "LIST_VIEW",
  "search": "SEARCH",
  "add_to_cart": "ADD_CART",
  "add_to_wishlist": "ADD_TO_WISHLIST",
  "begin_checkout": "START_CHECKOUT",
  "add_payment_info": "ADD_BILLING",
  "login": "LOGIN",
  "purchase": "PURCHASE",
  "sign_up": "SIGN_UP",
  "spend_virtual_currency": "SPENT_CREDITS",
  "subscribe": "SUBSCRIBE"
};

// helper functions
const getEventName = (eventName) => {
  if (ga4Events.hasOwnProperty(eventName)) {
    return ga4Events[eventName];
  }
  return eventName;
};

const hashSHA256 = (value) => {
  if (!value) {
    return value;
  }
  if (value.match('^[A-Fa-f0-9]{64}$') !== null) {
    return value;
  }
  return sha256Sync(value, {outputEncoding: 'hex'});
};

const getItemIds = (items) => {
  if (!items) return;
  if (items.length === 0) return;
  return items.map((item) => {
    return item.item_id || item.id;
  });
};

const getNumberOfItems = (items) => {
  if (!items) return;
  if (items.length === 0) return;
  const reducer = (previousValue, currentValue) => previousValue + currentValue;
  return items.map((item) => {
    return makeInteger(item.quantity);
  }).reduce(reducer, 0);
};

const getItemsValue = (items) => {
  if (!items) return;
  if (items.length === 0) return;
  const reducer = (previousValue, currentValue) => previousValue + currentValue;
  return Math.round(items.map((item) => {
    return makeInteger(item.quantity) * makeNumber(item.price); 
  }).reduce(reducer) * 100) / 100;
};


// GA4 Client Event Data
const eventData = getAllEventData();

// GA4 Client User Properties
const ga4UserProperties = eventData['x-ga-mp2-user_properties'] || eventData.user_properties || {};

// Snap Request Properties
let requestParams = {};

// Conversion Settings Parameters
requestParams.pixel_id = 
  data.pixelId;
requestParams.app_id = 
  eventData['x-sc-app-id'];
requestParams.snap_app_id =
  eventData['x-sc-snap-app-id'];
requestParams.hashed_idfv = 
  hashSHA256(eventData['x-sc-idfv']);

// User Properties
requestParams.user_agent = 
  eventData['x-sc-user-agent'] || eventData.user_agent;
requestParams.hashed_ip_address = 
  hashSHA256(eventData['x-sc-ip-address'] || eventData.ip_address || getRemoteAddress());
requestParams.hashed_email = 
  hashSHA256(eventData['x-sc-email'] || ga4UserProperties.email);
requestParams.hashed_phone_number = 
  hashSHA256(eventData['x-sc-phone-number'] || ga4UserProperties.phone_number);
requestParams.hashed_mobile_ad_id = 
  hashSHA256(eventData['x-sc-idfa'] || eventData['x-sc-aaid']);

// Conversion Parameters
requestParams.event_type = 
  eventData['x-sc-event-type'] || data.customEventName || data.standardEventName || getEventName(eventData.event_name);
requestParams.event_conversion_type = 
  data.eventConversionType || eventData['x-sc-event-conversion-type'] || eventData.event_conversion_type || 'WEB';
requestParams.event_tag = 
  data.eventTag || eventData['x-sc-event-tag'] || 'gtm';
requestParams.timestamp = 
  eventData['x-sc-timestamp'] || eventData.timestamp || Math.round(getTimestampMillis() / 1000);
requestParams.item_category = 
  eventData['x-sc-item-category'];
requestParams.item_ids = 
  eventData['x-sc-item-ids'] || getItemIds(eventData.items);
requestParams.description = 
  eventData['x-sc-description'];
requestParams.number_items = 
  eventData['x-sc-number-items'] || getNumberOfItems(eventData.items);
requestParams.price = 
  eventData['x-sc-price'] || eventData.value || getItemsValue(eventData.items);
requestParams.currency = 
  eventData['x-sc-currency'] || eventData.currency;
requestParams.transaction_id = 
  eventData['x-sc-transaction-id'] || eventData.transaction_id;
requestParams.level = 
  eventData['x-sc-level'];
requestParams.client_dedup_id = 
  eventData['x-sc-client-deup-id'] || eventData.event_id;
requestParams.data_use = 
  eventData['x-sc-data-use'];
requestParams.page_url = 
  eventData['x-sc-page-url'] || eventData.page_location;
requestParams.sign_up_method = 
  eventData['x-sc-sign-up-method'] || eventData.method;

// Snapchat Cookie ID
const scid = eventData['x-scid'] || getCookieValues('_scid')[0];
if (scid) {
  setCookie('_scid', scid, {
      'max-age': 3600 * 24 * 7, // ITP max limit 7 days
      domain: 'auto',
      path: '/',
      httpOnly: true,
      secure: true,
    });
  requestParams.uuid_c1 = scid;
}

// Snapchat Conversion API Settings
const postUrl = ['https:/', 'tr.snapchat.com', 'v2', isDebug ? 'validate' : 'conversion'].join('/'); 
      
// Send Event to Snapchat
sendHttpRequest(postUrl, (statusCode, headers, response) => {
  if (statusCode >= 200 && statusCode < 300) { 
    data.gtmOnSuccess();
    return;
  }
  data.gtmOnFailure();
  return;
}, {headers: {"Authorization": "Bearer " + data.apiToken, "Content-Type": 'application/json'}, method: 'POST'}, JSON.stringify(requestParams));


___SERVER_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "read_request",
        "versionId": "1"
      },
      "param": [
        {
          "key": "requestAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        },
        {
          "key": "headerAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        },
        {
          "key": "queryParameterAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "get_cookies",
        "versionId": "1"
      },
      "param": [
        {
          "key": "cookieAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "cookieNames",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "_scid"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "set_cookies",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedCookies",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "name"
                  },
                  {
                    "type": 1,
                    "string": "domain"
                  },
                  {
                    "type": 1,
                    "string": "path"
                  },
                  {
                    "type": 1,
                    "string": "secure"
                  },
                  {
                    "type": 1,
                    "string": "session"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "_scid"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "any"
                  },
                  {
                    "type": 1,
                    "string": "any"
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_event_data",
        "versionId": "1"
      },
      "param": [
        {
          "key": "eventDataAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "send_http",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedUrls",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://tr.snapchat.com/"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_container_data",
        "versionId": "1"
      },
      "param": []
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 18/06/2022, 23:46:20


